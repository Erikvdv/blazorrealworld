@using ServerClient.Extensions
@using Application.Interactors
@using Application.Models;

@inherits LayoutComponentBase
@inject AuthenticationStateProvider _authenticationStateProvider
@inject IUserInteractor _userInteractor

<Header Title="Conduit" />


@Body

<Footer />

@code{
    [CascadingParameter]
    private BrowserStateProvider? _browserStateProvider { get; set; }

    private User _user;

    protected override async Task OnInitializedAsync()
    {
        var _authProvider = _authenticationStateProvider as CustomAuthenticationStateProvider;
        var token = await _browserStateProvider!.GetTokenAsync();
        if (token == null) return;

        _user = await _userInteractor!.LoginWithTokenAsync(token);
        _authProvider!.SignInUser(_user);

    }

}