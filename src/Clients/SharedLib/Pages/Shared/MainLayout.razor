@using SharedLib.Extensions
@using Application.Interactors
@using Application.Models;
@using Microsoft.AspNetCore.Components.Authorization


@inherits LayoutComponentBase
@inject CustomAuthenticationStateProvider _authenticationStateProvider
@inject IUserInteractor _userInteractor

<Header Title="Conduit" />


@Body

<Footer />

@code{
    [CascadingParameter]
    private BrowserStateProvider? _browserStateProvider { get; set; }

    private User _user;

    protected override async Task OnInitializedAsync()
    {
        var token = await _browserStateProvider!.GetTokenAsync();
        if (string.IsNullOrEmpty(token)) return;

        _user = await _userInteractor!.LoginWithTokenAsync(token);
        _authenticationStateProvider!.SignInUser(_user);

    }

}