@using SharedLib.Extensions
@using Application.Services
@using Application.Models;


@inherits LayoutComponentBase
@inject CustomAuthenticationStateProvider _authenticationStateProvider
@inject IConduitApiService _apiService

<Header Title="Conduit" />


@Body

<Footer />

@code{
    [CascadingParameter]
    private BrowserStateProvider? _browserStateProvider { get; set; }

    private User _user;

    protected override async Task OnInitializedAsync()
    {
        var token = await _browserStateProvider!.GetTokenAsync();
        if (string.IsNullOrEmpty(token)) return;

        _user = await _apiService!.LoginWithTokenAsync(token);
        _authenticationStateProvider!.SignInUser(_user);

    }

}